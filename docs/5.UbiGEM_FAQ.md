# GEM 대응 FAQ (비전문가용)

GEM/SECS를 잘 모르는 사람도 현장에서 바로 참고할 수 있도록 정리한 FAQ입니다.

---

## 📑 목차 (Table of Contents)

- [⚠️ Q1. 알람이 보고가 안 되거나 이상하게 올라옵니다](#-q1-알람이-보고가-안-되거나-이상하게-올라옵니다)
- [📊 Q2. SV랑 DVVal이 뭐가 다른가요?](#-q2-sv랑-dvval이-뭐가-다른가요)
- [📃 Q3. Variable이 List Type인데 L0으로만 나옵니다](#-q3-variable이-list-type인데-보고-시-자꾸-l0하위-아이템-없음으로-나옵니다)
- [📡 Q4. RemoteCommand를 보내면 Nack가 떨어집니다](#-q4-remotecommand를-보내면-자꾸-nack가-떨어집니다)
- [🌐 Q5. 통신 연결이 아예 안 됩니다](#-q5-통신-연결이-아예-안-됩니다-연결-시도도-안-되는-느낌)
- [🔌 Q6. Socket 연결 후 바로 끊어집니다](#-q6-socket은-연결됐다가-바로-끊어집니다)
- [📥 Q7. OnReceived 이벤트가 발생하지 않습니다](#-q7-onreceived-이벤트가-전혀-발생하지-않습니다)
- [🇰🇷 Q8. 한글이 깨져서 보입니다](#-q8-한글이-깨져서-보입니다)
- [📝 현장용 한눈에 보기 요약](#-현장용-한눈에-보기-요약)

---

## ⚠ Q1. 알람이 보고가 안 되거나 이상하게 올라옵니다

알람에는 보통 두 가지 핵심 값이 있습니다.

- `alid` : 알람 ID (어떤 알람인지 구분하는 번호)
- `alcd` : 알람 코드 (알람 발생/해제 상태 표현)

---

### 1-1️⃣ `alid` 설정 확인

`alid`는 **데이터 타입에 따라 쓸 수 있는 값 범위**가 달라집니다.

- `format = I1` (signed 1 byte, -128 ~ 127)
  - `128 이상` 값을 쓰면 **범위를 넘어가서 문제**가 생길 수 있습니다.
  - 👉 일반적으로 `alid`는 **128 미만** 값에서 사용하는 것이 안전합니다.
- `format = U1` (unsigned 1 byte, 0 ~ 255)
  - `256 이상` 값을 쓰면 잘려서 **엉뚱한 값**이 됩니다.
  - 👉 `alid`는 **0 ~ 255 범위** 안에서만 사용해야 합니다.

> ✅ 요약  
> - I1이면 **128 이상 쓰지 않기**  
> - U1이면 **256 이상 쓰지 않기**

---

### 1-2️⃣ `alcd` 설정 확인

`alcd`는 **1바이트(B 타입, 0~255)** 값이며,  
**최상위 비트(맨 앞 비트)**를 알람 **발생/해제 플래그**로 사용합니다.

주의사항:

1. `alcd`를 **127 이상 ~ 255 이하** 값으로만 사용하면  
   - 최상위 비트가 이미 1인 상태라  
   - **알람 해제(Alarm Clear) 보고가 제대로 안 될 수 있습니다.**

2. `alcd`를 **255 초과** 값으로 설정하면  
   - 내부 `int → byte` 변환에서 값이 잘려  
   - **보고 자체가 안 될 수 있습니다.**

> ✅ 요약  
> - `alcd`는 **0 ~ 255 범위**에서만 사용  
> - 최상위 비트(발생/해제 규칙)는 **사내 규칙을 반드시 확인**

---

## 📊 Q2. SV랑 DVVal이 뭐가 다른가요?

이름은 비슷하지만 역할이 다릅니다.

- **SV (Status Variable)**  
  → 설비의 **현재 상태**를 나타내는 값  
  예) 장비 상태(Idle, Running), 도어 상태(Door Open/Close) 등

- **DVVal (Data Value)**  
  → 특정 VID에 대한 **보고용 데이터 값**  
  예) 검사 결과, 측정값, 레시피 파라미터 값 등

---

### 🔍 현장에서 기억할 포인트

- **SV**
  - 어플리케이션이 **가동 중인 동안에는 항상 값이 존재**해야 합니다.  
    (값이 비어 있으면 비정상)
- **DVVal**
  - 보통 **CE(컬렉션 이벤트) 보고 시점에만 의미**가 있습니다.

> ✅ 쉽게 정리  
> - **SV = 장비의 “현재 상태”**  
> - **DVVal = “보고 시 같이 보내는 측정/결과 값”**

---

## 📃 Q3. Variable이 List Type인데 보고 시 자꾸 L0(하위 아이템 없음)으로 나옵니다

List Type Variable은 **구조( VID, 하위 아이템 등 )를 정확히 맞춰야** 합니다.

---

### 3-1️⃣ 샘플 코드 참고

- 각 언어별 샘플 코드의  
  `OnVariableUpdateRequest` 이벤트 핸들러 내 주석에  
  **List Type 예제 코드**가 포함되어 있습니다.
- 👉 **예제 구조를 그대로 참고해서 구현**하는 것이 안전합니다.

---

### 3-2️⃣ L0(하위 아이템 없음)으로 나오는 경우

- 증상: 보고 시 List가 **L0 (하위 아이템 없음)** 으로 보임
- 대부분의 원인:
  - `Variable`의 **VID 값이 설정되지 않았을 때** 발생
- 조치:
  - 코드에서 **VID를 정확히 설정했는지** 다시 확인

> ✅ 요약  
> - List Type 문제 → **샘플 코드 구조 그대로 쓰는 것**이 가장 안전  
> - L0이면 **VID 설정 누락**부터 의심

---

## 📡 Q4. RemoteCommand를 보내면 자꾸 Nack가 떨어집니다

RemoteCommand Nack은 주로 **파라미터 이름/구조/검증 로직** 문제입니다.

---

### 📌 상황 1. 샘플 코드에서 의도적으로 Nack 발생

- 일부 샘플 코드에 테스트용으로 **임의 Nack 반환** 부분이 있습니다.
- 조치:
  1. 샘플 코드에서 **Parameter 검증 로직** 부분을 확인
  2. 실제 사용 조건에 맞게 수정
     - 조건 만족 시 → **Ack**
     - 조건 불만족 시 → **Nack**

---

### 📌 상황 2. Nack Code 1번 (Parameter 이름 없음)

대부분은 **이름/철자 오류**입니다.

- Host에서 내려온 데이터의 **Parameter 이름**과  
  UGC 설정에 등록된 **Parameter 이름**을 1:1로 비교해야 합니다.

체크 포인트:

1. **대소문자 완전 일치 여부** (Case Sensitive)
2. 엑셀에서 문자열을 복사해 설정툴에 붙여넣을 때
   - 앞/뒤에 **공백(space)** 이 붙어 있는 경우
   - 이 보이지 않는 공백 때문에 “이름 없음”으로 인식되는 상황 발생

> ✅ 요약  
> - “이름 없음” Nack → **철자 / 대소문자 / 앞뒤 공백부터 확인**

---

### 📌 상황 3. 2차원 이상 구조 데이터  
(Parameter가 `L`, 그 안의 `CPVal`도 `L` 인 경우)

- 예) 리스트 안에 리스트가 들어있는 복잡한 구조

조치:

- **UGC 파일에 설정된 구조**와  
  **SECS2 로그에 찍힌 실제 수신 데이터 구조**가  
  **완전히 동일한지** 비교해야 합니다.

> ✅ 요약  
> - 구조가 조금만 달라도 해석 불가 → Nack 발생  
> - 이 경우 **UGC 구조 vs SECS2 로그 구조를 나란히 놓고 비교**하는 것이 가장 빠름

---

## 🌐 Q5. 통신 연결이 아예 안 됩니다 (연결 시도도 안 되는 느낌)

통신 자체가 안 붙을 때는 아래 순서대로 점검합니다.

---

### 5-1️⃣ 네트워크 설정

1. **NIC IP 설정**
   - 장비와 PC가 **같은 네트워크 대역**인지 확인
   - IP, 서브넷 마스크 등이 정상인지 확인

2. **OS 방화벽 설정**
   - Windows 방화벽, 사내 보안 솔루션 등에서  
     해당 포트를 **막고 있는지 여부** 확인

---

### 5-2️⃣ UGC 설정 & 파일 경로

3. **UGC 파일의 IP/Port 설정**
   - 실제 장비/Host와 통신해야 하는 IP/Port와  
     UGC에 등록된 값이 **일치하는지 확인**

4. **Initialize 시 사용하는 UGC 파일 경로**
   - 어플리케이션에서 사용하는 UGC 파일 경로와  
     설정툴에서 수정한 UGC 파일 경로가  
     **서로 다른 경우**가 실제로 발생한 적이 있음
   - 👉 “수정한 파일(A)”이 아니라 “다른 파일(B)”을 읽고 있는지 확인

---

## 🔌 Q6. Socket은 연결됐다가 바로 끊어집니다

연결은 되지만 **금방 끊기는 경우**입니다.

---

### 6-1️⃣ 방화벽 재확인

- 특정 패턴의 연결을 **즉시 차단하는 정책**이 있을 수 있습니다.
- 연결 직후 차단하는 로그/정책 여부 확인

---

### 6-2️⃣ Device ID 확인 (S9F1 로그 여부)

1. 끊어지기 직전에 **S9F1 로그**가 찍혀 있는지 확인
2. S9F1이 있다면 보통 **Device ID 불일치**일 가능성이 큽니다.
3. 장비와 Host 양쪽 설정에서 **Device ID 값이 동일한지** 확인

---

## 📥 Q7. OnReceived 이벤트가 전혀 발생하지 않습니다

데이터가 오가는 느낌도 없고, 이벤트도 안 뜨는 상황입니다.

---

### 7-1️⃣ Stream / Function 번호 확인

1. **SECS1, SECS2 로그**를 열어봅니다.
2. Host/장비가 사용하는 **Stream 번호, Function 번호**를 확인합니다.
3. 해당 **S/F 조합이 GEM 표준에서 허용되는지** 확인합니다.

- 실제 현장에서,  
  **GEM 표준에서 사용하지 않는 Stream/Function 조합**을 사용해  
  장비가 메시지를 무시한 사례가 있습니다.

> ✅ 요약  
> - 이벤트가 안 뜨면 **먼저 S/F 조합이 표준에 맞는지** 확인

---

## 🇰🇷 Q8. 한글이 깨져서 보입니다

한글 깨짐은 대체로 **OS 언어/인코딩 설정 문제**입니다.

---

### 8-1️⃣ OS 및 인코딩 설정 확인

- Windows의 **시스템 로케일(System Locale)**  
- 사용자 계정의 **기본 인코딩 설정**
- 장비/Host 양쪽에서 사용하는 문자 인코딩이 같은지 확인  
  (예: EUC-KR, UTF-8 등)

---

## 📝 현장용 한눈에 보기 요약

- **알람 문제**  
  - `alid` → 타입(I1/U1)과 값 범위 확인  
  - `alcd` → 0~255 사용, 최상위 비트 규칙 확인

- **SV / DVVal 구분**  
  - SV → 장비 **현재 상태**, 항상 값 존재  
  - DVVal → **보고 시점의 데이터 값**

- **List Type Variable**  
  - 샘플 코드의 `OnVariableUpdateRequest` 예제 구조 참고  
  - 보고 시 L0이면 **VID 설정 누락** 의심

- **RemoteCommand Nack**  
  - 샘플 코드의 임의 Nack 로직 제거/수정  
  - Nack Code 1(이름 없음) → 철자/대소문자/공백 확인  
  - 2D 이상 구조 → UGC 구조 vs SECS2 로그 구조 비교

- **통신이 아예 안 됨**  
  - NIC IP, 서브넷 확인  
  - OS 방화벽/보안 솔루션 확인  
  - UGC IP/Port 확인  
  - 실제 사용하는 UGC 파일 경로 확인

- **Socket 바로 끊김**  
  - 방화벽 정책 재확인  
  - S9F1 로그 여부 확인 → Device ID 불일치 검사

- **OnReceived 이벤트 없음**  
  - SECS1/SECS2 로그의 S/F 번호 확인  
  - GEM 표준에 맞는 조합인지 체크

- **한글 깨짐**  
  - OS 시스템 로케일, 인코딩 설정 확인  
  - 장비/Host 인코딩(EUC-KR, UTF-8 등) 일치 여부 확인
